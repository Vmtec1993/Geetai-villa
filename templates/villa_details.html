{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
    <div id="villaSlider" class="carousel slide shadow-sm" data-bs-ride="carousel" style="border-radius: 20px; overflow: hidden;">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{{ villa.Image_URL }}" class="d-block w-100" style="height: 350px; object-fit: cover;">
            </div>
            {% if villa.Image_URL_2 %}<div class="carousel-item"><img src="{{ villa.Image_URL_2 }}" class="d-block w-100" style="height: 350px; object-fit: cover;"></div>{% endif %}
            {% if villa.Image_URL_3 %}<div class="carousel-item"><img src="{{ villa.Image_URL_3 }}" class="d-block w-100" style="height: 350px; object-fit: cover;"></div>{% endif %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#villaSlider" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" type="button" data-bs-target="#villaSlider" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="mt-4 px-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="fw-bold m-0">{{ villa.Villa_Name }}</h2>
            
            {% if villa.Offer_End %}
            <div class="text-danger fw-bold small border border-danger px-2 py-1 rounded shadow-sm bg-light">
                <i class="bi bi-clock-history"></i> Ends: 
                <span id="sheet-timer" data-expire="{{ villa.Offer_End }}">Loading...</span>
            </div>
            {% endif %}
        </div>

        <span class="badge bg-primary mb-3">{{ villa.BHK }} BHK Villa</span>
        <p class="text-muted">{{ villa.Description }}</p>
        
        <div class="bg-light p-3 rounded-4 my-4">
            <h6 class="fw-bold mb-3">âœ¨ Premium Amenities</h6>
            <div class="row g-2 text-center small">
                <div class="col-4"><div class="bg-white p-2 rounded shadow-sm"><i class="bi bi-water text-primary"></i><br>Pool</div></div>
                <div class="col-4"><div class="bg-white p-2 rounded shadow-sm"><i class="bi bi-snow text-info"></i><br>AC</div></div>
                <div class="col-4"><div class="bg-white p-2 rounded shadow-sm"><i class="bi bi-wifi text-success"></i><br>WiFi</div></div>
            </div>
        </div>

        <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-primary w-100 rounded-pill py-3 fw-bold">Book This Villa</a>
    </div>
</div>

<script>
    function startSheetTimer() {
        const timerElement = document.getElementById('sheet-timer');
        if (!timerElement) return;

        const expireDateStr = timerElement.getAttribute('data-expire'); 
        const countTo = new Date(expireDateStr).getTime();

        const x = setInterval(function() {
            const now = new Date().getTime();
            const diff = countTo - now;

            if (isNaN(countTo)) {
                timerElement.innerHTML = "Invalid Date";
                clearInterval(x);
                return;
            }

            if (diff < 0) {
                clearInterval(x);
                timerElement.innerHTML = "OFFER EXPIRED";
                return;
            }

            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            timerElement.innerHTML = 
                (h < 10 ? "0" + h : h) + "h " + 
                (m < 10 ? "0" + m : m) + "m " + 
                (s < 10 ? "0" + s : s) + "s";
        }, 1000);
    }
    
    // Page load hote hi start karein
    document.addEventListener('DOMContentLoaded', startSheetTimer);
</script>
{% endblock %}
