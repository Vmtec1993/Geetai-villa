{% extends 'base.html' %}
{% block content %}

<div class="position-relative overflow-hidden shadow-lg" style="height: 500px; background-color: #000;">
    <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=1920&q=80" class="w-100 h-100" style="object-fit: cover; opacity: 0.6;">
    <div class="position-absolute top-50 start-50 translate-middle text-center text-white w-100 px-3">
        <h1 class="display-3 fw-bold mb-2">Welcome to MoreVistas</h1>
        <p class="lead fs-4 mb-4 opacity-75">More Luxury. More Comfort. More Memories.</p>
        <a href="#villas" class="btn btn-warning btn-lg rounded-pill px-5 fw-bold shadow">Explore Stays</a>
    </div>
</div>

<div class="container py-5" id="villas">
    <div class="row g-4">
        {% for villa in villas %}
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden position-relative">
                
                {% if villa.Offer %}
                <div class="position-absolute top-0 end-0 m-3 z-3 text-end">
                    <span class="badge badge-offer border-0 shadow py-2 px-3 rounded-pill text-white fw-bold d-block mb-1">
                        <i class="bi bi-fire me-1"></i> {{ villa.Offer }}
                    </span>
                    {% if villa.Offer_End %}
                    <div class="timer-box bg-dark text-white p-1 px-2 rounded-3 small fw-bold" 
                         data-deadline="{{ villa.Offer_End }}">
                         Ends: <span class="text-warning timer-display">--:--:--</span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <div class="overflow-hidden">
                    <img src="{{ villa.Image_Main }}" class="card-img-top" style="height:250px; object-fit:cover;">
                </div>

                <div class="card-body p-4">
                    <h5 class="fw-bold">{{ villa.Name }}</h5>
                    <p class="text-muted small mb-3"><i class="bi bi-geo-alt me-1"></i> Lonavala, MH</p>
                    <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                        <span class="text-primary fw-bold fs-4">â‚¹{{ villa.Price }}</span>
                        <a href="/villa/{{ villa.Villa_ID }}" class="btn btn-outline-dark rounded-pill px-4">Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .badge-offer { background: linear-gradient(45deg, #ef4444, #b91c1c); }
    .timer-box { font-size: 11px; border: 1px solid rgba(255,255,255,0.2); animation: blink 1.5s infinite; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
</style>

<script>
    function updateCountdowns() {
        document.querySelectorAll('.timer-box').forEach(timer => {
            const deadline = new Date(timer.getAttribute('data-deadline')).getTime();
            const now = new Date().getTime();
            const distance = deadline - now;
            const display = timer.querySelector('.timer-display');

            if (distance < 0) { timer.style.display = 'none'; return; }

            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((distance % (1000 * 60)) / 1000);
            display.innerHTML = `${h}h ${m}m ${s}s`;
        });
    }
    setInterval(updateCountdowns, 1000);
    updateCountdowns();
</script>
{% endblock %}
