{% extends 'base.html' %}
{% block content %}

<div class="position-relative overflow-hidden" style="height: 450px; background-color: #000;">
    <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=1920" class="w-100 h-100" style="object-fit: cover; opacity: 0.6;">
    <div class="position-absolute top-50 start-50 translate-middle text-center text-white">
        <h1 class="display-4 fw-bold">MoreVistas Luxury</h1>
    </div>
</div>

<div class="container py-5">
    <div class="row g-4">
        {% for villa in villas %}
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden position-relative">
                
                {% if villa.Offer and villa.Offer_End %}
                <div class="position-absolute top-0 end-0 m-3 z-3 text-end">
                    <span class="badge bg-danger shadow py-2 px-3 rounded-pill text-white fw-bold d-block mb-1">
                        {{ villa.Offer }}
                    </span>
                    <div class="timer-box bg-dark text-white p-1 px-2 rounded-3 small fw-bold" 
                         data-deadline="{{ villa.Offer_End }}">
                         Ends: <span class="text-warning timer-display">Calculating...</span>
                    </div>
                </div>
                {% endif %}

                <img src="{{ villa.Image_Main }}" class="card-img-top" style="height:250px; object-fit:cover;">

                <div class="card-body p-4 text-center">
                    <h5 class="fw-bold">{{ villa.Name }}</h5>
                    <a href="/villa/{{ villa.Villa_ID }}" class="btn btn-dark rounded-pill px-4 mt-2">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .timer-box { font-size: 11px; border: 1px solid rgba(255,255,255,0.2); }
</style>

<script>
    function updateCountdowns() {
        document.querySelectorAll('.timer-box').forEach(timer => {
            const deadlineStr = timer.getAttribute('data-deadline');
            // ' ' को 'T' से बदलें ताकि ब्राउज़र सही से समझ सके (ISO format)
            const deadline = new Date(deadlineStr.replace(' ', 'T')).getTime();
            const now = new Date().getTime();
            const distance = deadline - now;
            const display = timer.querySelector('.timer-display');

            if (isNaN(deadline) || distance < 0) {
                display.innerHTML = "Offer Ended";
                return;
            }

            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((distance % (1000 * 60)) / 1000);
            
            display.innerHTML = h + "h " + m + "m " + s + "s";
        });
    }
    // हर सेकंड अपडेट करें
    setInterval(updateCountdowns, 1000);
    updateCountdowns();
</script>
{% endblock %}
